{% extends "share/base_ui.html" %}

{% block title %}Lobber{% endblock %}

{% block js %}
<script type="text/javascript">
$(function() {
	$('#expdate').datepicker({'dateFormat': 'yy-mm-dd'});
	$('#newkey-dialog').dialog({
		autoOpen: false,
	   	height: 200,
	   	width: 500,
	   	modal: true,
	   	buttons: {
	   	   'Ok': function() {
	   	      $('#expdate-dialog form').submit();
	   	      $(this).dialog('close');
	   	   }
	   	},
	   	close: function() {
	   	   $('#expdate').val('').removeClass('ui-state-error');
	   	}
	});
	$('#expdate-dialog form').submit(function() {
		$.post($(this).attr('action'),$(this).serialize(),function(data) {
		   if (data) {
   	          $('#notification').jnotifyAddMessage({
                 text: data,
                 permanent: false
              });
   	       }
		});
		return false;
	});
	$("#keys").accordion({ 
   			header: "h3", 
   			event: "click", 
   			collapsible: true,
   			active: false
   	});
});
</script>
{% endblock %}

{% block main %}
{% if keys %}
<div id="newkey-dialog" class="modal-dialog" title="Create new key">
   <form action="/key.html">
      <fieldset>
         <input type="hidden" name="username" id="username" value=""/>
         <label for="expdate">Expiration date</label>
         <input type="text" name="expdate" id="expdate" value="" class="text ui-widget-content ui-corner-all"></input>
      </fieldset>
   </form>
</div>


<h1>Keys</h1>
<div id="keys">
  {% for profile in keys %}
    <div class="key" id="{{ profile.get_username }}">
      <h3><a href="#{{ profile.get_username }}">{{ profile.get_username }}</a></h3>
      <div>
		<table>
	      <tr><td>Entitlements</td><td>{{ profile.entitlements }}</td></tr>
		  <tr><td>URL filter</td><td>{{ profile.urlfilter }}</td></tr>
		  <tr><td>Tag constraints</td><td>{{ profile.tagconstraints }}</td></tr>
		  <tr><td>Expiration date</td><td>{{ profile.expiration_date }}</td></tr>
		</table>
      </div>
    </div>
  {% endfor %}
</div>
{% else %}
  <p>No keys.</p>
{% endif %}
{% endblock %}
