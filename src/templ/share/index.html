{% extends "share/base_ui.html" %}

{% block title %}Lobber{% endblock %}
{% block js %}
<script type="text/javascript">
var link = $('#link'),email = $('#email'),allFields = $([]).add(name).add(email);
$(function() {
   $('#share-mail-dialog').dialog({
       position: ['center','center'],
       autoOpen: false,
       height: 240,
       width: 350,
       modal: true,
       buttons: {
          'Send email': function() {
             $(this).dialog('close');
          },
          'Cancel': function() {
             $(this).dialog('close');
          }
       },
       close: function() {
          allFields.val('').removeClass('ui-state-error');
       }
   });
   $('#share-link-dialog').dialog({
       position: ['center','center'],
       autoOpen: false,
       height: 100,
       width: 350,
       modal: true,
       buttons: {
          'Ok': function() {
             $(this).dialog('close');
          }
       },
       close: function() {
          allFields.val('').removeClass('ui-state-error');
       }
   });
});
function gufrt2(id) {
   $('#link').load("gufrt/"+id);
   $('#share-link-dialog').dialog('open');
}
function mailit(id) {
   $('#share-mail-dialog').dialog('open');
}

</script>
{% endblock %}

{% block main %}
<div class="button">
  <a href="/upload/">Upload using Java Web Start</a>
  <a href="/ulform/">Upload a torrent file</a>
</div>

<div id="share-link-dialog" class="modal-dialog" title="Share data">
     <p>
        <div id="link" class="text"></div>
     </p>
</div>

<div id="share-mail-dialog" class="modal-dialog" title="Share data">
   <form>
        <fieldset>
                <label for="to">Email</label>
                <input type="text" name="to" id="to" value="" size="40" class="text ui-widget-content ui-corner-all" />
                <label for="message">Message</label>
                <textarea name="message" id="message" value="" rows="4" cols="40" class="text ui-widget-content ui-corner-all"></textarea>
        </fieldset>
   </form>
</div>

{% if torrents %}
<h1>Published Torrents</h1>
<div id="accordion">
    {% for t in torrents %}
      <div>
	<h3><a href="#">{{ t.name }} - created at {{t.creation_date}}</a></h3>
        <div>
	   <div class="navlist">
             <ul>
                <li>
                   <a class="tip" title="Download this data using a torrent client" href="{{t.data.url}}">
                      <span class="ui-icon ui-icon-arrowthickstop-1-s"></span>
                   </a>
                </li>
                <li>
                   <a class="tip" title="Download this data using the download manager" href="/torrent/{{t.hashval}}.jnlp">
                      <span class="ui-icon ui-icon-folder-open"></span>
                   </a>
                </li>
                <li>
                   <a class="tip" title="Share a link to this data" href="javascript:void(0);" onClick="gufrt2('{{t.id}}')">
                      <span class="ui-icon ui-icon-extlink"></span>
                   </a>
                </li>
                <li>
                   <a class="tip" title="Send a link to this data" href="javascript:void(0);" onClick="mailit('{{t.id}}')">
                      <span class="ui-icon ui-icon-mail-closed"></span>
                   </a>
                </li>
                <li style="float: right;">
                   <a class="tip" title="Remove this torrent" href="/torrent/delete/{{t.hashval}}">
                      <span class="ui-icon ui-icon-trash"></span>
                   </a>
                </li>
                <li style="float: right;">
                   <a class="tip" title="Modify settings for this torrent" href="/torrent/{{t.hashval}}.html">
                      <span class="ui-icon ui-icon-wrench"></span>
                   </a>
                </li>
             <ul> 
           </div>
           {% if t.description %}
           <div class="description">
              <h4>Description:</h4>
              <p>{{t.description}}</p>
           </div>
           {% endif %} 
        </div>
      </div>
    {% endfor %}
</div>
{% else %}
  <p>Seems like we're out of shared material.</p>
{% endif %}
{% endblock %}
